<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è®¾ç½® - å¬å¬éŸ³ä¹</title>
    <link rel="stylesheet" href="/static/styles-mobile.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>å¬å¬éŸ³ä¹</h1>
            <div class="header-actions">
                <a href="/mobile" class="nav-btn">è¿”å›</a>
            </div>
        </header>
        
        <main class="settings-main">
            <div class="settings-container">
                <h2>è®¾ç½®</h2>
                
                <!-- æ’­æ”¾è®¾ç½® -->
                <section class="settings-section collapsible">
                    <h3 class="section-title" onclick="toggleSection(this)">
                        <span>ğŸµ æ’­æ”¾è®¾ç½®</span>
                        <span class="expand-icon">â–¼</span>
                    </h3>
                    <div class="section-content">
                        <div class="setting-item">
                            <label for="default-play-mode">é»˜è®¤æ’­æ”¾æ¨¡å¼</label>
                            <select id="default-play-mode">
                                <option value="0">é¡ºåºæ’­æ”¾</option>
                                <option value="1">å•æ›²å¾ªç¯</option>
                                <option value="2">åˆ—è¡¨å¾ªç¯</option>
                                <option value="3">éšæœºæ’­æ”¾</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="default-volume">é»˜è®¤éŸ³é‡</label>
                            <div class="volume-control">
                                <input type="range" id="default-volume" min="0" max="100" value="70">
                                <span class="setting-value" id="volume-value">70%</span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- æ˜¾ç¤ºè®¾ç½® -->
                <section class="settings-section collapsible">
                    <h3 class="section-title" onclick="toggleSection(this)">
                        <span>ğŸ‘ï¸ æ˜¾ç¤ºè®¾ç½®</span>
                        <span class="expand-icon">â–¼</span>
                    </h3>
                    <div class="section-content">
                        <div class="setting-item">
                            <label for="show-artist">æ˜¾ç¤ºè‰ºæœ¯å®¶</label>
                            <select id="show-artist">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="show-album">æ˜¾ç¤ºä¸“è¾‘</label>
                            <select id="show-album">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="show-filename">æ˜¾ç¤ºæ–‡ä»¶å</label>
                            <select id="show-filename">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="show-bitrate">æ˜¾ç¤ºç¼–ç ç‡</label>
                            <select id="show-bitrate">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="show-sample-rate">æ˜¾ç¤ºé‡‡æ ·ç‡</label>
                            <select id="show-sample-rate">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="show-file-type">æ˜¾ç¤ºæ–‡ä»¶æ ¼å¼</label>
                            <select id="show-file-type">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="theme-select">ä¸»é¢˜:</label>
                            <select id="theme-select">
                                <option value="dark">æ·±è‰²ä¸»é¢˜</option>
                                <option value="light">æµ…è‰²ä¸»é¢˜</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="font-size">å­—ä½“å¤§å°:</label>
                            <select id="font-size">
                                <option value="small">å°</option>
                                <option value="medium" selected>ä¸­</option>
                                <option value="large">å¤§</option>
                            </select>
                        </div>
                    </div>
                </section>
                
                <!-- æ­Œè¯è®¾ç½® -->
                <section class="settings-section collapsible">
                    <h3 class="section-title" onclick="toggleSection(this)">
                        <span>ğŸ¤ æ­Œè¯è®¾ç½®</span>
                        <span class="expand-icon">â–¼</span>
                    </h3>
                    <div class="section-content">
                        <div class="setting-item">
                            <label for="lyric-folder">æ­Œè¯æ–‡ä»¶å¤¹</label>
                            <div class="current-folder">
                                <span id="current-lyric-folder">ä½¿ç”¨éŸ³ä¹æ–‡ä»¶åŒç›®å½•</span>
                            </div>
                            <div class="folder-actions">
                                <input type="text" id="new-lyric-folder" placeholder="è¾“å…¥æ­Œè¯æ–‡ä»¶å¤¹è·¯å¾„ï¼Œç•™ç©ºåˆ™ä½¿ç”¨éŸ³ä¹æ–‡ä»¶åŒç›®å½•">
                                <button id="save-lyric-folder-btn" class="primary-btn">ä¿å­˜</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- æ­Œå•éŸ³ä¹æ–‡ä»¶å¤¹ -->
                <section class="settings-section collapsible">
                    <h3 class="section-title" onclick="toggleSection(this)">
                        <span>ğŸ“ æ­Œå•æ–‡ä»¶å¤¹</span>
                        <span class="expand-icon">â–¼</span>
                    </h3>
                    <div class="section-content">
                        <div id="playlists-folders-container">
                            <!-- æ­Œå•éŸ³ä¹æ–‡ä»¶å¤¹è®¾ç½®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </section>
                
                <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
                <section class="settings-section collapsible">
                    <h3 class="section-title" onclick="toggleSection(this)">
                        <span>â„¹ï¸ ç‰ˆæœ¬ä¿¡æ¯</span>
                        <span class="expand-icon">â–¼</span>
                    </h3>
                    <div class="section-content">
                        <div class="setting-item">
                            <label>å½“å‰ç‰ˆæœ¬: <span id="version-number">1.0.1</span></label>
                        </div>
                        <div class="setting-item">
                            <p>å¬å¬éŸ³ä¹æ˜¯ä¸€æ¬¾ç®€å•æ˜“ç”¨çš„NASéŸ³ä¹æ’­æ”¾å™¨ï¼Œæ”¯æŒWebç•Œé¢å’ŒAPIè®¿é—®ï¼Œå¯åœ¨æ‰‹æœºå’Œç”µè„‘ä¸Šä½¿ç”¨ã€‚</p>
                        </div>
                        <div class="setting-item">
                            <label>ä¸»è¦åŠŸèƒ½ï¼š</label>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼æ’­æ”¾ï¼šMP3ã€FLACã€WAVã€AACã€OGGã€ALACã€AIFFã€APEç­‰</li>
                                <li>è‡ªåŠ¨æ‰«æéŸ³ä¹æ–‡ä»¶å¤¹</li>
                                <li>æ”¯æŒæ’­æ”¾åˆ—è¡¨ç®¡ç†</li>
                                <li>æ”¯æŒæ­Œè¯æ˜¾ç¤º</li>
                                <li>æ”¯æŒå¤šç§æ’­æ”¾æ¨¡å¼</li>
                                <li>æ”¯æŒè®¾ç½®é»˜è®¤éŸ³é‡å’Œæ’­æ”¾æ¨¡å¼</li>
                            </ul>
                        </div>
                    </div>
                </section>
                
                <!-- è”ç³»æ–¹å¼ -->
                <section class="settings-section collapsible">
                    <h3 class="section-title" onclick="toggleSection(this)">
                        <span>ğŸ“ è”ç³»æ–¹å¼</span>
                        <span class="expand-icon">â–¼</span>
                    </h3>
                    <div class="section-content">
                        <div class="setting-item">
                            <p>å…¬ä¼—å·ï¼šçº¢è–¯ä¸¸å­</p>
                            <p>å¾®ä¿¡å·ï¼šhhkj5525</p>
                        </div>
                    </div>
                </section>
                
                <!-- ä¿å­˜æŒ‰é’® -->
                <div class="settings-actions">
                    <button id="save-settings-btn" class="primary-btn">ä¿å­˜è®¾ç½®</button>
                    <button id="cancel-btn" class="secondary-btn">å–æ¶ˆ</button>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // æŠ˜å å¼è®¾ç½®åŠŸèƒ½
        function toggleSection(element) {
            const section = element.closest('.settings-section');
            section.classList.toggle('collapsed');
        }
        
        // è®¾ç½®é¡µé¢JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            
            // æ’­æ”¾è®¾ç½®
            const playModeSelect = document.getElementById('default-play-mode');
            const volumeRange = document.getElementById('default-volume');
            const volumeValue = document.getElementById('volume-value');
            
            // éŸ³é‡æ§åˆ¶
            volumeRange.addEventListener('input', function() {
                volumeValue.textContent = this.value + '%';
            });
            
            // æ˜¾ç¤ºè®¾ç½®
            const displaySettings = ['show-artist', 'show-album', 'show-filename', 'show-bitrate', 'show-sample-rate', 'show-file-type'];
            displaySettings.forEach(id => {
                const select = document.getElementById(id);
                select.value = localStorage.getItem(id) || 'true';
            });
            
            // ä¸»é¢˜åˆ‡æ¢
            const themeSelect = document.getElementById('theme-select');
            const currentTheme = localStorage.getItem('theme') || 'dark';
            themeSelect.value = currentTheme;
            document.body.className = currentTheme === 'light' ? 'light-theme' : '';
            
            themeSelect.addEventListener('change', function() {
                const theme = this.value;
                localStorage.setItem('theme', theme);
                document.body.className = theme === 'light' ? 'light-theme' : '';
            });
            
            // å­—ä½“å¤§å°è®¾ç½®
            const fontSizeSelect = document.getElementById('font-size');
            const currentFontSize = localStorage.getItem('fontSize') || 'medium';
            fontSizeSelect.value = currentFontSize;
            document.body.style.fontSize = currentFontSize === 'small' ? '0.9rem' : currentFontSize === 'large' ? '1.1rem' : '1rem';
            
            fontSizeSelect.addEventListener('change', function() {
                const fontSize = this.value;
                localStorage.setItem('fontSize', fontSize);
                document.body.style.fontSize = fontSize === 'small' ? '0.9rem' : fontSize === 'large' ? '1.1rem' : '1rem';
            });
            
            // æ­Œè¯æ–‡ä»¶å¤¹ä¿å­˜
            document.getElementById('save-lyric-folder-btn').addEventListener('click', function() {
                const lyricFolder = document.getElementById('new-lyric-folder').value;
                localStorage.setItem('lyric-folder', lyricFolder);
                document.getElementById('current-lyric-folder').textContent = lyricFolder || 'ä½¿ç”¨éŸ³ä¹æ–‡ä»¶åŒç›®å½•';
                this.textContent = 'å·²ä¿å­˜';
                setTimeout(() => this.textContent = 'ä¿å­˜', 2000);
            });
            
            // åŠ è½½æ’­æ”¾åˆ—è¡¨
            async function loadPlaylists() {
                try {
                    const response = await fetch('/api/playlists');
                    const playlists = await response.json();
                    renderPlaylistsFolders(playlists);
                } catch (error) {
                    console.error('åŠ è½½æ’­æ”¾åˆ—è¡¨å¤±è´¥:', error);
                    const container = document.getElementById('playlists-folders-container');
                    container.innerHTML = '<p style="color: var(--text-tertiary); text-align: center;">åŠ è½½å¤±è´¥</p>';
                }
            }
            
            // æ¸²æŸ“æ­Œå•éŸ³ä¹æ–‡ä»¶å¤¹è®¾ç½®
            function renderPlaylistsFolders(playlists) {
                const container = document.getElementById('playlists-folders-container');
                container.innerHTML = '';
                
                playlists.forEach(playlist => {
                    // è·³è¿‡"æœ€æ–°æ’­æ”¾"æ­Œå•
                    if (playlist.name === 'æœ€è¿‘æ’­æ”¾') {
                        return;
                    }
                    
                    const playlistItem = document.createElement('div');
                    playlistItem.className = 'setting-item';
                    playlistItem.dataset.playlistId = playlist.id;
                    
                    playlistItem.innerHTML = `
                        <label for="playlist-folder-${playlist.id}">${playlist.name} - éŸ³ä¹æ–‡ä»¶å¤¹</label>
                        <div class="current-folder">
                            <span id="current-playlist-folder-${playlist.id}">${playlist.music_dir || 'æœªè®¾ç½®'}</span>
                        </div>
                        <div class="folder-actions">
                            <input type="text" id="playlist-folder-${playlist.id}" placeholder="è¾“å…¥éŸ³ä¹æ–‡ä»¶å¤¹è·¯å¾„" value="${playlist.music_dir || ''}">
                            <button class="primary-btn" onclick="savePlaylistFolder(${playlist.id})">ä¿å­˜</button>
                        </div>
                    `;
                    
                    container.appendChild(playlistItem);
                });
            }
            
            // ä¿å­˜æ­Œå•éŸ³ä¹æ–‡ä»¶å¤¹è®¾ç½®
            async function savePlaylistFolder(playlistId) {
                const folderPath = document.getElementById(`playlist-folder-${playlistId}`).value;
                
                try {
                    const response = await fetch(`/api/playlists/${playlistId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ music_dir: folderPath || null })
                    });
                    
                    if (response.ok) {
                        const playlist = await response.json();
                        document.getElementById(`current-playlist-folder-${playlistId}`).textContent = playlist.music_dir || 'æœªè®¾ç½®';
                        alert('è®¾ç½®å·²ä¿å­˜');
                    } else {
                        alert('ä¿å­˜å¤±è´¥');
                    }
                } catch (error) {
                    console.error('ä¿å­˜æ­Œå•æ–‡ä»¶å¤¹å¤±è´¥:', error);
                    alert('ä¿å­˜å¤±è´¥');
                }
            }
            
            // å…¨å±€å‡½æ•°ï¼Œä¾›HTMLè°ƒç”¨
            window.savePlaylistFolder = savePlaylistFolder;
            
            // ä¿å­˜æ‰€æœ‰è®¾ç½®ï¼ˆä¸åŒ…æ‹¬æ­Œå•æ–‡ä»¶å¤¹ï¼Œå®ƒä»¬é€šè¿‡APIä¿å­˜ï¼‰
            document.getElementById('save-settings-btn').addEventListener('click', function() {
                // ä¿å­˜æ’­æ”¾è®¾ç½®
                localStorage.setItem('default-play-mode', playModeSelect.value);
                localStorage.setItem('default-volume', volumeRange.value);
                
                // ä¿å­˜æ˜¾ç¤ºè®¾ç½®
                displaySettings.forEach(id => {
                    localStorage.setItem(id, document.getElementById(id).value);
                });
                
                // ä¿å­˜ä¸»é¢˜å’Œå­—ä½“è®¾ç½®
                localStorage.setItem('theme', themeSelect.value);
                localStorage.setItem('fontSize', fontSizeSelect.value);
                
                // åŒæ­¥æ‰€æœ‰æ­Œå•æ–‡ä»¶å¤¹è®¾ç½®
                const playlistInputs = document.querySelectorAll('input[id^="playlist-folder-"]');
                playlistInputs.forEach(input => {
                    const playlistId = input.id.replace('playlist-folder-', '');
                    savePlaylistFolder(playlistId);
                });
                
                this.textContent = 'å·²ä¿å­˜';
                setTimeout(() => this.textContent = 'ä¿å­˜è®¾ç½®', 2000);
            });
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancel-btn').addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦å–æ¶ˆå—ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¸¢å¤±ã€‚')) {
                    window.location.href = '/mobile';
                }
            });
            
            // åŠ è½½æ’­æ”¾åˆ—è¡¨
            loadPlaylists();
            
            // åŠ è½½ä¿å­˜çš„è®¾ç½®
            playModeSelect.value = localStorage.getItem('default-play-mode') || '0';
            volumeRange.value = localStorage.getItem('default-volume') || '70';
            volumeValue.textContent = volumeRange.value + '%';
            
            const lyricFolder = localStorage.getItem('lyric-folder') || '';
            document.getElementById('current-lyric-folder').textContent = lyricFolder || 'ä½¿ç”¨éŸ³ä¹æ–‡ä»¶åŒç›®å½•';
        });
    </script>
</body>
</html>